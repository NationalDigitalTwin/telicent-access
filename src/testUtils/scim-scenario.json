{
  "name": "SCIM 2.0 specification test",
  "version": "1.0",
  "steps": [
    {
      "url": "{{url}}/IsEnabled",
      "method": "GET",
      "step_type": "request",
      "headers": {
        "Accept-Charset": ["utf-8"],
        "Content-Type": ["application/scim+json; charset=utf-8"],
        "Authorization": ["{{auth}}"],
        "Accept": ["application/scim+json"],
        "User-Agent": ["SCIM Integration"]
      },
      "assertions": [
        {
          "comparison": "equal_number",
          "value": "200",
          "source": "response_status"
        },
        {
          "comparison": "equal",
          "property": "isEnabled",
          "value": "true",
          "source": "response_json"
        }
      ]
    },
    {
      "url": "{{url}}/Users",
      "method": "GET",
      "step_type": "request",
      "headers": {
        "Accept-Charset": ["utf-8"],
        "Content-Type": ["application/scim+json; charset=utf-8"],
        "Authorization": ["{{auth}}"],
        "Accept": ["application/scim+json"],
        "User-Agent": ["SCIM Integration"]
      },
      "variables": [
        {
          "source": "response_json",
          "property": "Resources[0].externalId",
          "name": "userId"
        }
      ],
      "assertions": [
        {
          "comparison": "equal_number",
          "value": "200",
          "source": "response_status"
        },
        {
          "comparison": "not_empty",
          "property": "Resources",
          "source": "response_json"
        },
        {
          "comparison": "has_value",
          "property": "schemas",
          "value": "urn:ietf:params:scim:api:messages:2.0:ListResponse",
          "source": "response_json"
        },
        {
          "comparison": "is_a_number",
          "property": "itemsPerPage",
          "source": "response_json"
        },
        {
          "comparison": "is_a_number",
          "property": "startIndex",
          "source": "response_json"
        },
        {
          "comparison": "is_a_number",
          "property": "totalResults",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].id",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].externalId",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].userName",
          "value": "null",
          "source": "response_json"
        },
        {
          "comparison": "empty",
          "property": "Resources[0].groups",
          "value": "null",
          "source": "response_json"
        },
        {
          "comparison": "has_value",
          "property": "Resources[0].schemas",
          "value": "urn:ietf:params:scim:schemas:core:2.0:User",
          "source": "response_json"
        }
      ]
    },
    {
      "url": "{{url}}/Users/{{userId}}",
      "method": "GET",
      "step_type": "request",
      "headers": {
        "Accept-Charset": ["utf-8"],
        "Content-Type": ["application/scim+json; charset=utf-8"],
        "Authorization": ["{{auth}}"],
        "Accept": ["application/scim+json"],
        "User-Agent": ["SCIM Integration"]
      },
      "assertions": [
        {
          "comparison": "equal_number",
          "value": "200",
          "source": "response_status"
        },
        {
          "comparison": "not_empty",
          "property": "id",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "externalId",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "externalId",
          "value": "{{userId}}",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "userName",
          "source": "response_json"
        },
        {
          "comparison": "empty",
          "property": "groups",
          "source": "response_json"
        },
        {
          "comparison": "has_value",
          "property": "schemas",
          "value": "urn:ietf:params:scim:schemas:core:2.0:User",
          "source": "response_json"
        }
      ]
    },
    {
      "url": "{{url}}/Users",
      "method": "POST",
      "body": "{\"schemas\":[\"urn:ietf:params:scim:schemas:core:2.0:User\"],\"userName\":\"{{random_string(8)}}\",\"emails\":[{\"value\":\"user@telicent.io\"}],\"schemas\":\"urn:ietf:params:scim:schemas:core:2.0:User\",\"groups\":[\"urn:telicent:groups:developers\",\"urn:telicent:groups:group2\"]}",
      "step_type": "request",
      "headers": {
        "Content-Type": ["application/json"],
        "Accept": ["application/scim+json; charset=utf-8"],
        "Authorization": ["{{auth}}"]
      },
      "variables": [
        {
          "source": "response_json",
          "property": "id",
          "name": "createdUserId"
        }
      ],
      "assertions": [
        {
          "comparison": "equal_number",
          "value": "201",
          "source": "response_status"
        },
        {
          "comparison": "not_empty",
          "property": "id",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "externalId",
          "source": "response_json"
        },
        {
          "comparison": "contains",
          "property": "schemas",
          "value": "urn:ietf:params:scim:schemas:core:2.0:User",
          "source": "response_json"
        }
      ]
    },
    {
      "duration": 1, 
      "step_type": "pause"
    }, 
    {
      "url": "{{url}}/Users/{{createdUserId}}",
      "method": "PATCH",
      "body": "{\"Operations\": [{\"op\": \"replace\",\"value\": true}]}",
      "step_type": "request",
      "headers": {
        "Accept-Charset": ["utf-8"],
        "Content-Type": ["application/scim+json; charset=utf-8"],
        "Authorization": ["{{auth}}"],
        "Accept": ["application/scim+json"],
        "User-Agent": ["SCIM Integration"]
      },
      "assertions": [
        {
          "comparison": "equal_number",
          "value": "501",
          "source": "response_status"
        }
      ]
    },
    {
      "duration": 1, 
      "step_type": "pause"
    }, 
    {
      "url": "{{url}}/Users/{{createdUserId}}",
      "method": "PUT",
      "body": "{\"Operations\": [{\"op\": \"replace\",\"value\": true}]}",
      "step_type": "request",
      "headers": {
        "Accept-Charset": ["utf-8"],
        "Content-Type": ["application/scim+json; charset=utf-8"],
        "Authorization": ["{{auth}}"],
        "Accept": ["application/scim+json"],
        "User-Agent": ["SCIM Integration"]
      },
      "assertions": [
        {
          "comparison": "equal_number",
          "value": "501",
          "source": "response_status"
        }
      ]
    },
    {
      "duration": 1, 
      "step_type": "pause"
    }, 
    {
      "url": "{{url}}/Users/{{createdUserId}}",
      "method": "DELETE",
      "step_type": "request",
      "headers": {
        "Accept-Charset": ["utf-8"],
        "Content-Type": ["application/scim+json; charset=utf-8"],
        "Authorization": ["{{auth}}"],
        "Accept": ["application/scim+json"],
        "User-Agent": ["SCIM Integration"]
      },
      "assertions": [
        {
          "comparison": "equal_number",
          "value": "200",
          "source": "response_status"
        },
        {
          "comparison": "equal",
          "property": "ok",
          "value": "true",
          "source": "response_json"
        }
      ]
    },
    {
      "url": "{{url}}/ServiceProviderConfig",
      "method": "GET",
      "step_type": "request",
      "headers": {
        "Accept-Charset": ["utf-8"],
        "Content-Type": ["application/scim+json; charset=utf-8"],
        "Authorization": ["{{auth}}"],
        "Accept": ["application/scim+json"],
        "User-Agent": ["SCIM Integration"]
      },
      "assertions": [
        {
          "comparison": "equal_number",
          "value": "200",
          "source": "response_status"
        },
        {
          "comparison": "equal",
          "property": "documentationUri",
          "value": "/api-docs/swagger",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "patch",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "bulk",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "filter",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "changePassword",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "sort",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "schemas[0]",
          "value": "urn:ietf:params:scim:schemas:core:2.0:ServiceProviderConfig",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "etag",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "authenticationSchemes",
          "source": "response_json"
        }
      ]
    },
    {
      "url": "{{url}}/ResourceTypes",
      "method": "GET",
      "step_type": "request",
      "headers": {
        "Accept-Charset": ["utf-8"],
        "Content-Type": ["application/scim+json; charset=utf-8"],
        "Authorization": ["{{auth}}"],
        "Accept": ["application/scim+json"],
        "User-Agent": ["SCIM Integration"]
      },
      "variables": [
        {
          "source": "response_json",
          "property": "Resources[0].id",
          "name": "resourceTypeId"
        }
      ],
      "assertions": [
        {
          "comparison": "equal_number",
          "value": "200",
          "source": "response_status"
        },
        {
          "comparison": "is_a_number",
          "property": "totalResults",
          "source": "response_json"
        },
        {
          "comparison": "is_a_number",
          "property": "itemsPerPage",
          "source": "response_json"
        },
        {
          "comparison": "is_a_number",
          "property": "startIndex",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "schemas[0]",
          "value": "urn:ietf:params:scim:api:messages:2.0:ListResponse",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "Resources[0].id",
          "value": "User",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "Resources[0].name",
          "value": "User",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "Resources[0].endpoint",
          "value": "/Users",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "Resources[0].schema",
          "value": "urn:ietf:params:scim:schemas:core:2.0:User",
          "source": "response_json"
        },
        {
          "comparison": "has_value",
          "property": "Resources[0].schemas",
          "value": "urn:ietf:params:scim:schemas:core:2.0:ResourceType",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].meta",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "Resources[0].meta.location",
          "value": "{{url}}/ResourceTypes/User",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "Resources[0].meta.resourceType",
          "value": "ResourceType",
          "source": "response_json"
        }
      ]
    },
    {
      "url": "{{url}}/ResourceTypes/{{resourceTypeId}}",
      "method": "GET",
      "step_type": "request",
      "headers": {
        "Accept-Charset": ["utf-8"],
        "Content-Type": ["application/scim+json; charset=utf-8"],
        "Authorization": ["{{auth}}"],
        "Accept": ["application/scim+json"],
        "User-Agent": ["SCIM Integration"]
      },
      "assertions": [
        {
          "comparison": "equal_number",
          "value": "200",
          "source": "response_status"
        },
        {
          "comparison": "equal",
          "property": "id",
          "value": "{{resourceTypeId}}",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "name",
          "value": "{{resourceTypeId}}",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "endpoint",
          "value": "/Users",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "schema",
          "value": "urn:ietf:params:scim:schemas:core:2.0:{{resourceTypeId}}",
          "source": "response_json"
        },
        {
          "comparison": "has_value",
          "property": "schemas",
          "value": "urn:ietf:params:scim:schemas:core:2.0:ResourceType",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "meta",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "meta.location",
          "value": "{{url}}/ResourceTypes/{{resourceTypeId}}",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "meta.resourceType",
          "value": "ResourceType",
          "source": "response_json"
        }
      ]
    },
    {
      "url": "{{url}}/Schemas",
      "method": "GET",
      "step_type": "request",
      "headers": {
        "Accept-Charset": ["utf-8"],
        "Content-Type": ["application/scim+json; charset=utf-8"],
        "Authorization": ["{{auth}}"],
        "Accept": ["application/scim+json"],
        "User-Agent": ["SCIM Integration"]
      },
      "variables": [
        {
          "source": "response_json",
          "property": "Resources[0].id",
          "name": "schemaId"
        }
      ],
      "assertions": [
        {
          "comparison": "equal_number",
          "value": "200",
          "source": "response_status"
        },
        {
          "comparison": "is_a_number",
          "property": "totalResults",
          "source": "response_json"
        },
        {
          "comparison": "is_a_number",
          "property": "itemsPerPage",
          "source": "response_json"
        },
        {
          "comparison": "is_a_number",
          "property": "startIndex",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "schemas[0]",
          "value": "urn:ietf:params:scim:api:messages:2.0:ListResponse",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "Resources[0].id",
          "value": "urn:ietf:params:scim:schemas:core:2.0:{{resourceTypeId}}",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "Resources[0].name",
          "value": "{{resourceTypeId}}",
          "source": "response_json"
        },
        {
          "comparison": "has_value",
          "property": "Resources[0].schemas",
          "value": "urn:ietf:params:scim:schemas:core:2.0:Schema",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "Resources[0].description",
          "value": "{{resourceTypeId}} Schema",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].attributes",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].attributes[0].name",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].attributes[0].type",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].attributes[0].multiValued",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].attributes[0].required",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].attributes[0].caseExact",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].attributes[0].mutability",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].attributes[0].returned",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].attributes[0].uniqueness",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].attributes[0].description",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "Resources[0].meta",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "Resources[0].meta.location",
          "value": "{{url}}/Schemas/urn:ietf:params:scim:schemas:core:2.0:User",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "Resources[0].meta.resourceType",
          "value": "Schema",
          "source": "response_json"
        }
      ]
    },
    {
      "url": "{{url}}/Schemas/{{schemaId}}",
      "method": "GET",
      "step_type": "request",
      "headers": {
        "Accept-Charset": ["utf-8"],
        "Content-Type": ["application/scim+json; charset=utf-8"],
        "Authorization": ["{{auth}}"],
        "Accept": ["application/scim+json"],
        "User-Agent": ["SCIM Integration"]
      },
      "assertions": [
        {
          "comparison": "equal_number",
          "value": "200",
          "source": "response_status"
        },
        {
          "comparison": "equal",
          "property": "id",
          "value": "urn:ietf:params:scim:schemas:core:2.0:{{resourceTypeId}}",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "name",
          "value": "{{resourceTypeId}}",
          "source": "response_json"
        },
        {
          "comparison": "has_value",
          "property": "schemas",
          "value": "urn:ietf:params:scim:schemas:core:2.0:Schema",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "description",
          "value": "{{resourceTypeId}} Schema",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "attributes",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "attributes[0].name",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "attributes[0].type",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "attributes[0].multiValued",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "attributes[0].required",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "attributes[0].caseExact",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "attributes[0].mutability",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "attributes[0].returned",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "attributes[0].uniqueness",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "attributes[0].description",
          "source": "response_json"
        },
        {
          "comparison": "not_empty",
          "property": "meta",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "meta.location",
          "value": "{{url}}/Schemas/{{schemaId}}",
          "source": "response_json"
        },
        {
          "comparison": "equal",
          "property": "meta.resourceType",
          "value": "Schema",
          "source": "response_json"
        }
      ]
    }
  ]
}
